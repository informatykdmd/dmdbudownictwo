{% extends 'base.html' %}
{% block MainSlider %}
{% endblock %}

{% block content %}
<!--Sidebar Page Container-->
<div class="sidebar-page-container">
    <div class="auto-container">
        <div class="row clearfix">
            
            <!--Content Side-->
            <div class="content-side col-lg-8 col-md-8 col-sm-12 col-xs-12">
                <div class="blog-single">
                    
                    <!--News Block Three-->
                    <div class="news-block-three">
                        <div class="inner-box">
                            <div class="image">
                                <img src="{{choiced['mainFoto']}}" alt="{{choiced['title']}}">
                                <div class="post-date">{{choiced['data']}}</div>
                            </div>
                            <div class="lower-content">
                                <ul class="post-meta">
                                    <li><a href="#"><span class="icon fa fa-user"></span>{{choiced['author']}}</a></li>
                                    <li><a href="#"><span class="icon fa fa-comment-o"></span>{{choiced['len']}}  Komentarzy </a></li>
                                </ul>
                                <h3>{{choiced['title']}}</h3>
                                <div class="text">
                                    <p>
                                        {{choiced['introduction']}}
                                    </p>
                                    <blockquote>
                                        {{choiced['highlight']}}
                                    </blockquote>
                                    <div><img src="{{choiced['contentFoto']}}" style="width: 100%;" alt="{{choiced['title']}}"></div>
                                    <ul>
                                        {% for point in choiced['additionalList'] %}
                                        <li style="margin-top: 15px;">
                                            {{point}}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    <h4 style="margin-top: 25px;">TAGI:</h4>
                                    <ul  class="social-icon-four">
                                        {% for tag in choiced['tags'] %}
                                        <li><a href="#">{{tag}}</a></li>
                                        {% endfor %}
                                      </ul>
                                </div>
                                <!--post-share-options-->
                                <div class="post-share-options clearfix">
                                    <div class="pull-left">
                                        <ul class="social-icon-four">
                                            <li class="share">Share Now:</li>
                                            <li>
                                                <a 
                                                    class="icon fa fa-facebook" 
                                                    href="https://www.facebook.com/sharer/sharer.php?u=https://www.dmdbudownictwo.pl/blog-one-pl?post={{choiced['id']}}&title={{choiced['title']}}&description={{choiced['highlight']}}&picture=https://dmdbudownictwo.pl/static/images/logo_dmd_budownictwo.png"
                                                    target="_blank">
                                                </a>
                                            </li>
                                            <li>
                                                <a 
                                                    class="icon fa fa-twitter" 
                                                    href="https://twitter.com/intent/tweet?text={{choiced['highlight']}}&url=https://www.dmdbudownictwo.pl/blog-one-pl?post={{choiced['id']}}" 
                                                    target="_blank">
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="pull-right posts">
                                        <ul>
                                            {% if pre_next['prev'] != None %}
                                            <li class="prev"><a href="/blog-one?post={{pre_next['prev']}}"><span class="fa fa-angle-double-left"></span> Poprzedni</a></li>
                                            {% endif %}
                                            {% if pre_next['next'] != None %}
                                            <li><a href="/blog-one?post={{pre_next['next']}}">Następny <span class="fa fa-angle-double-right"></span></a></li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!--Comments Area-->
                    <div class="comments-area">
                        <!--Comment Box-->
                        <div class="comment-box">
                            <div class="comment">
                                <div class="content">
                                    <div class="author-thumb"><img src="{{choiced['author_avatar']}}" alt=""></div>
                                    <div class="comment-inner">
                                        <div class="comment-info clearfix"><strong>{{choiced['author']}}</strong></div>
                                        <div class="text">{{choiced['author_about']}}</div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% if choiced['len'] > 0 %}
                            <div class="sec-title">
                                <h2><span class="theme_color">{{choiced['len']}}</span> Komentarzy</h2>
                            </div>
                            
                            {% for comm in choiced['comments'].values() %}
                            <!--Comment Box-->
                            <div class="comment-box">
                                <div class="comment">
                                    {% if comm['avatar'] %}
                                        <div class="content">
                                            <div class="author-thumb"><img src="{{comm['avatar']}}" alt=""></div>
                                            <div class="comment-inner">
                                                <div class="comment-info clearfix"><strong>{{comm['user']}}</strong><div class="comment-time">{{comm['data-time']}}</div></div>
                                                <div class="text">{{comm['message']}}</div>
                                                <!-- <a class="comment-reply" href="#">Reply</a> -->
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="content-2">
                                            <div class="comment-info clearfix"><strong>{{comm['user']}}</strong><div class="comment-time">{{comm['data-time']}}</div></div>
                                            <div class="text">{{comm['message']}}</div>
                                            <!-- <a class="comment-reply" href="#">Reply</a> -->
                                        </div>

                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% endif %}
                        
                    </div>
                    
                    <!-- Comment Form -->
                    <div class="comment-form">
                        <div class="sec-title">
                            <h2><span class="theme_color">Komentuj</span> post</h2>
                        </div>
                        <!--Comment Form-->
                        <form id="Comments">
                            <div class="row clearfix">
                                <div class="col-md-6 col-sm-12 col-xs-12 form-group">
                                    <input type="text" name="Name" placeholder="Imię" required>
                                </div>
                                
                                <div class="col-md-6 col-sm-12 col-xs-12 form-group">
                                    <input type="email" name="Email" placeholder="E-mail (nie zostanie opublikowany)" required>
                                </div>
                                
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                                    <input type="hidden" name="id" value="{{choiced['id']}}" />
                                    <textarea name="Comment" placeholder="Twój komentarz"></textarea>
                                </div>
                                
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                                    <button class="theme-btn btn-style-one" type="submit" id="przycisk">Komentuj</button>
                                </div>
                                <div style="margin-top: 20px;" id="komunikat_z_serwera"></div>
                            </div>
                        </form>
                            
                    </div>
                    <!--End Comment Form --> 
                    
                </div>
            </div>
            
            <!--Sidebar Side-->
            <div class="sidebar-side col-lg-4 col-md-4 col-sm-12 col-xs-12">
                <aside class="sidebar default-sidebar">
                    
                    <!-- Search -->
                    <div class="sidebar-widget search-box">
                        <form method="post" action="contact.html">
                            <div class="form-group">
                                <input type="search" name="search-field" value="" placeholder="Search here..." required>
                                <button type="submit"><span class="icon fa fa-search"></span></button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- category -->
                    <div class="sidebar-widget category-widget">
                        <div class="sidebar-title">
                            <h2><span class="theme_color">Best </span>Categories</h2>
                        </div>
                        <ul class="cat-list">
                            <li><a href="#">Builing Construction</a></li>
                            <li><a href="#">Building Interior Renovation</a></li>
                            <li><a href="#">Hardwood Flooring</a></li>
                            <li><a href="#">Roof Repairing</a></li>
                            <li><a href="#">Architecture Consulting</a></li>
                            <li><a href="#">Interior Design Package</a></li>
                        </ul>
                    </div>
                    
                    <!-- Popular Posts -->
                    <div class="sidebar-widget popular-posts">
                        <div class="sidebar-title"><h2>Recent news</h2></div>

                        <article class="post">
                            <figure class="post-thumb"><img src="images/resource/post-thumb-1.jpg" alt=""><a href="blog-detail.html" class="overlay-box"><span class="icon fa fa-link"></span></a></figure>
                            <div class="text"><a href="blog-detail.html">Construction Honored With DBC Builderst</a></div>
                            <div class="post-info">18 Dec 2017</div>
                        </article>

                        <article class="post">
                            <figure class="post-thumb"><img src="images/resource/post-thumb-2.jpg" alt=""><a href="blog-detail.html" class="overlay-box"><span class="icon fa fa-link"></span></a></figure>
                            <div class="text"><a href="blog-detail.html">How Important Is Light In The Living Room?</a></div>
                            <div class="post-info">18 Nov 2017</div>
                        </article>
                        
                        <article class="post">
                            <figure class="post-thumb"><img src="images/resource/post-thumb-3.jpg" alt=""><a href="blog-detail.html" class="overlay-box"><span class="icon fa fa-link"></span></a></figure>
                            <div class="text"><a href="blog-detail.html">How To Build Attractive Construction Plan</a></div>
                            <div class="post-info">20 Oct 2017</div>
                        </article>
                        
                    </div>
                    
                    <!-- Archive -->
                    <div class="sidebar-widget archive-widget">
                        <div class="sidebar-title">
                            <h2><span class="theme_color">Our </span>Archives</h2>
                        </div>
                        <ul class="cat-list">
                            <li><a href="#">January 09, 2017</a></li>
                            <li><a href="#">March 30, 2017</a></li>
                            <li><a href="#">June 25, 2017</a></li>
                        </ul>
                    </div>
                    
                    <!--Solution Box-->
                    <div class="solution-box" style="background-image:url(images/resource/image-2.jpg)">
                        <div class="inner">
                            <div class="title">Quick Contact</div>
                            <h2>Get Solution</h2>
                            <div class="text">Contact us at the Constration office nearest to you or submit a business inquiry online.</div>
                            <a class="solution-btn theme-btn" href="contact.html">Contact Us</a>
                        </div>
                    </div>
                    
                </aside>
            </div>
            
        </div>
    </div>
</div>
<!--End Sidebar Page Container-->

{% endblock %}
{% block bottom_scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById('Comments').addEventListener('submit', function(e) {
            e.preventDefault(); // Zapobiegaj domyślnej akcji formularza
            const formData = new FormData(this); // Użyj 'this', aby odnieść się do formularza
            const jsonFormData = Object.fromEntries(formData.entries());

            fetch('/add-comm-pl', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(jsonFormData) // Przekazuj dane z formularza
            })
            .then(response => response.json())
            .then(data => {
                // console.log(data);

                const komunikatDiv = document.getElementById("komunikat_z_serwera");
                if (komunikatDiv) {
                    komunikatDiv.innerHTML = data.message;
                    // Ustawienie koloru komunikatu na podstawie wartości 'success'
                    if(data.success) {
                        komunikatDiv.style.color = "green"; // Sukces - zielony
                        document.getElementById('Comments').reset();
                        setTimeout(function() { // Opóźnienie przed przeładowaniem, aby użytkownik zdążył zobaczyć komunikat
                            window.location.reload();
                        }, 1500);
                    } else {
                        komunikatDiv.style.color = "red"; // Niepowodzenie - czerwony
                    }
                    setTimeout(function() {
                        komunikatDiv.innerHTML = '';
                    }, 5000);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    });
</script>
    
{% endblock %}
